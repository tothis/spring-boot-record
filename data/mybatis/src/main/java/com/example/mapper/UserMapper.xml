<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.UserMapper">
    <!--JDBC Type           Java Type-->
    <!--CHAR                String-->
    <!--VARCHAR             String-->
    <!--LONGVARCHAR         String-->
    <!--NUMERIC             java.math.BigDecimal-->
    <!--DECIMAL             java.math.BigDecimal-->
    <!--BIT                 boolean-->
    <!--BOOLEAN             boolean-->
    <!--TINYINT             byte-->
    <!--SMALLINT            short-->
    <!--INTEGER             INTEGER-->
    <!--BIGINT              long-->
    <!--REAL                float-->
    <!--FLOAT               double-->
    <!--DOUBLE              double-->
    <!--BINARY              byte[]-->
    <!--VARBINARY           byte[]-->
    <!--LONGVARBINARY       byte[]-->
    <!--DATE                java.sql.Date-->
    <!--TIME                java.sql.Time-->
    <!--TIMESTAMP           java.sql.Timestamp-->
    <!--CLOB                Clob-->
    <!--BLOB                Blob-->
    <!--ARRAY               Array-->
    <!--DISTINCT            mapping of underlying type-->
    <!--STRUCT              Struct-->
    <!--REF                 Ref-->
    <!--DATALINK            java.net.URL-->

    <resultMap id="user" type="user">
        <id property="id" javaType="Long" column="id" jdbcType="BIGINT"/>
        <result property="userName" javaType="String" column="user_name" jdbcType="VARCHAR"/>
        <result property="password" javaType="String" column="password" jdbcType="VARCHAR"/>
        <result property="age" javaType="Byte" column="age" jdbcType="TINYINT"/>
        <!-- 内部类不能使用别名 -->
        <collection property="addressList" ofType="com.example.model.User$Address">
            <result column="id1" property="id"/>
            <result column="detail" property="detail"/>
        </collection>
    </resultMap>

    <select id="findAll" resultMap="user">
        SELECT
            a.id
            , a.user_name
            , a.password
            , a.age
            , a.address
            , b.id AS id1
            , b.detail
        FROM user a
        LEFT JOIN address b ON b.user_id = a.id
    </select>

    <select id="findMap" resultMap="user">
        SELECT id, user_name, password, age, mail, birthday, address FROM `user`
        <where>
            <if test="userName != null and userName != ''">
                AND user_name LIKE "%"#{userName}"%"
            </if>
            <if test="age != null and age != ''">
                AND age = #{age}
            </if>
        </where>
    </select>
</mapper>
