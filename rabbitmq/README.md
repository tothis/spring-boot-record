# RabbitMQ

### 介绍
AMQP由交换器 队列和绑定三部分组成

交换器类型
+ 点对点
  + 直接 direct 发布到路由键指定队列
  + 消息头 headers 发布到消息头属性指定队列 不可指配路由键
+ 发布/订阅
  + 扇出 fanout 发布到交换器绑定的所有队列 不可指配路由键
  + 主题 topic 发布到可模糊匹配的路由键指定队列

+ 代理服务器(Message Broker) 即代表一个RabbitMQ服务
+ 生产者(Producer): 创建消息 发布到代理服务器
+ 消费者(Consumer): 订阅队列 代理服务器将发送消息给一个订阅的消费者
+ 消息(Message): 由有效载荷(payload)和标签(label)组成 有效载荷即传输的数据
+ 连接(Connection): 即与代理服务器建立的TCP连接
+ 信道(Channel): 生产者/消费者和代理服务器之间TCP连接内的虚拟连接 每个连接可创建多个信道
+ 交换器(Exchange): 根据分发规则 匹配查询表中的路由键(Fanout Exchange除外)
+ 队列(Queue): 消息的载体 每个消息都会被投到一个或多个队列
+ 路由键(RoutingKey): 消息发送给交换器时 消息将拥有一个路由键(默认为空)
交换器根据路由键将消息发送到匹配的队列中
+ 绑定键(BindingKey): 路由键在消费者中的概念
+ 绑定(Binding) 把交换器和队列按照路由规则绑定起来
+ 虚拟主机(Virtual Host): 虚拟主机 一个虚拟主机相当于一个用户 用作权限分离
***
生产者生产消息过程
1. 建立连接
2. 开启一个信道
3. 声明一个交换器
4. 声明一个队列
5. 通过路由键绑定队列和交换器
6. 交换器发送信息至队列 交换器类型不同发送信息至队列规则不同
RabbitMQ根据路由键查找队列 队列存在 则消息存入对应队列中 队列不存在
则根据生产者的配置进行丢弃或回退给生产者
7. 关闭信道
8. 关闭连接

消费者消费消息过程
1. 建立连接
2. 开启一个信道
3. 请求消费指定队列的消息 并设置回调函数(onMessage)
4. RabbitMQ将消息推送给消费者
5. 消费者发送消息确定(ACK 即Acknowledge character)
6. RabbitMQ删除已确认消息
7. 关闭信道
8. 关闭连接